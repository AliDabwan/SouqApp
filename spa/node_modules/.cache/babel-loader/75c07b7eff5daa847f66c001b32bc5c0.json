{"ast":null,"code":"import _regeneratorRuntime from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";import{toast}from\"react-toastify\";import{history}from\"../..\";import{PaginatedResponse}from\"../models/PaginationData\";import{SouqStore}from\"../store/configureStore\";var sleep=function sleep(){return new Promise(function(resolve){return setTimeout(resolve,500);});};// axios.defaults.baseURL = 'http://localhost:5000/api/';\naxios.defaults.baseURL=process.env.REACT_APP_API_URL;axios.defaults.withCredentials=true;axios.interceptors.request.use(function(config){var _SouqStore$getState$a;var token=(_SouqStore$getState$a=SouqStore.getState().account.user)===null||_SouqStore$getState$a===void 0?void 0:_SouqStore$getState$a.token;if(token)config.headers.Authorization=\"Bearer \".concat(token);return config;});axios.interceptors.response.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var pagination;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(process.env.NODE_ENV==='development')){_context.next=3;break;}_context.next=3;return sleep();case 3:pagination=response.headers['pagination'];if(!pagination){_context.next=7;break;}response.data=new PaginatedResponse(response.data,JSON.parse(pagination));return _context.abrupt(\"return\",response);case 7:return _context.abrupt(\"return\",response);case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),function(error){var _ref2=error.response,data=_ref2.data,status=_ref2.status;switch(status){case 400:if(data.errors){var modelStateErrors=[];for(var key in data.errors){if(data.errors[key]){modelStateErrors.push(data.errors[key]);}}throw modelStateErrors.flat();}toast.error(data.title);break;case 401:toast.error(data.title);break;case 403:toast.error('You are not authorized to do this !');break;case 500:history.push('server-error',{error:data});break;default:break;}return Promise.reject(error.response);});var responseBody=function responseBody(response){return response.data;};var requests={get:function get(url,params){return axios.get(url,{params:params}).then(responseBody);},post:function post(url,body){return axios.post(url,body).then(responseBody);},put:function put(url,body){return axios.put(url,body).then(responseBody);},delete:function _delete(url){return axios.delete(url).then(responseBody);},postForm:function postForm(url,data){return axios.post(url,data,{headers:{'Content-type':'multipart/from-data'}}).then(responseBody);},putForm:function putForm(url,data){return axios.put(url,data,{headers:{'Content-type':'multipart/from-data'}}).then(responseBody);}};var createFormData=function createFormData(product){var formData=new FormData();for(var key in product){formData.append(key,product[key]);}return formData;};//to return void use {} after arrow func \n//to return promise delete {} after arrow func\nvar Admin={createProduct:function createProduct(product){return requests.postForm('products',createFormData(product));},updateProduct:function updateProduct(product){return requests.putForm('products',createFormData(product));},deleteProduct:function deleteProduct(id){return requests.delete(\"products/\".concat(id));}};var Catalog={list:function list(params){return requests.get('products',params);},details:function details(id){return requests.get(\"products/\".concat(id));},fetchFilters:function fetchFilters(){return requests.get('products/filters');}};var Errors={get400Error:function get400Error(){return requests.get('error/bad-request');},get401Error:function get401Error(){return requests.get('error/unauthorized');},get404Error:function get404Error(){return requests.get('error/not-found');},getValidationError:function getValidationError(){return requests.get('error/validation-error');},get500Error:function get500Error(){return requests.get('error/server-error');}};var Basket={get:function get(){return requests.get('basket');},addItem:function addItem(productId){var quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return requests.post(\"basket?productId=\".concat(productId,\"&quantity=\").concat(quantity),{});},deleteItem:function deleteItem(productId){var quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return requests.delete(\"basket?productId=\".concat(productId,\"&quantity=\").concat(quantity));}};var Account={login:function login(values){return requests.post('account/login',values);},register:function register(values){return requests.post('account/register',values);},currentUser:function currentUser(){return requests.get('account/currentUser');},fetchAddress:function fetchAddress(){return requests.get('account/savedAddress');}};var Orders={list:function list(){return requests.get('orders');},fetch:function fetch(id){return requests.get(\"orders/\".concat(id));},create:function create(values){return requests.post('orders',values);}};var Payment={createPaymentIntent:function createPaymentIntent(){return requests.post('payment',{});}};var agent={Catalog:Catalog,Errors:Errors,Basket:Basket,Account:Account,Orders:Orders,Payment:Payment,Admin:Admin};export default agent;","map":{"version":3,"sources":["D:/Learn/react/SouqApp/spa/src/app/api/agent.ts"],"names":["axios","toast","history","PaginatedResponse","SouqStore","sleep","Promise","resolve","setTimeout","defaults","baseURL","process","env","REACT_APP_API_URL","withCredentials","interceptors","request","use","config","token","getState","account","user","headers","Authorization","response","NODE_ENV","pagination","data","JSON","parse","error","status","errors","modelStateErrors","key","push","flat","title","reject","responseBody","requests","get","url","params","then","post","body","put","delete","postForm","putForm","createFormData","product","formData","FormData","append","Admin","createProduct","updateProduct","deleteProduct","id","Catalog","list","details","fetchFilters","Errors","get400Error","get401Error","get404Error","getValidationError","get500Error","Basket","addItem","productId","quantity","deleteItem","Account","login","values","register","currentUser","fetchAddress","Orders","fetch","create","Payment","createPaymentIntent","agent"],"mappings":"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","sourcesContent":["import axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport { toast } from \"react-toastify\";\r\nimport { history } from \"../..\";\r\nimport { PaginatedResponse } from \"../models/PaginationData\";\r\nimport { SouqStore } from \"../store/configureStore\";\r\n\r\nconst sleep = () => new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n// axios.defaults.baseURL = 'http://localhost:5000/api/';\r\naxios.defaults.baseURL = process.env.REACT_APP_API_URL;\r\n\r\n\r\naxios.defaults.withCredentials=true;\r\n\r\naxios.interceptors.request.use(config=>{\r\n    const token=SouqStore.getState().account.user?.token;\r\n    if(token)config.headers!.Authorization=`Bearer ${token}`;\r\n    return config;\r\n})\r\n\r\naxios.interceptors.response.use(async response => {\r\n\r\n    if(process.env.NODE_ENV==='development')await sleep();\r\n\r\n    const pagination=response.headers['pagination'];\r\n    if(pagination){\r\n        response.data=new PaginatedResponse(response.data,JSON.parse(pagination));\r\n        return response;\r\n    }\r\n    return response\r\n}, (error: AxiosError) => {\r\n    const { data, status } = error.response!;\r\n\r\n    switch (status) {\r\n        case 400:\r\n            if (data.errors) {\r\n                const modelStateErrors: string[] = [];\r\n                for (const key in data.errors) {\r\n                    if (data.errors[key]) {\r\n                        modelStateErrors.push(data.errors[key])\r\n                    }\r\n                }\r\n                throw modelStateErrors.flat()\r\n            }\r\n            toast.error(data.title)\r\n            break;\r\n        case 401:\r\n            toast.error(data.title)\r\n           \r\n            break;\r\n            case 403:\r\n                toast.error('You are not authorized to do this !')\r\n               \r\n                break;\r\n        case 500:\r\n            history.push('server-error', { error: data })\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return Promise.reject(error.response);\r\n})\r\nconst responseBody = (response: AxiosResponse) => response.data;\r\nconst requests = {\r\n    get: (url: string,params?:URLSearchParams) => axios.get(url,{params:params}).then(responseBody),\r\n    post: (url: string, body: {}) => axios.post(url, body).then(responseBody),\r\n    put: (url: string, body: {}) => axios.put(url, body).then(responseBody),\r\n    delete: (url: string) => axios.delete(url).then(responseBody),\r\n    postForm:(url:string,data:FormData)=>\r\n        axios.post(url,data,{\r\n            headers:{'Content-type':'multipart/from-data'}\r\n        }).then(responseBody)\r\n    ,\r\n    putForm:(url:string,data:FormData)=>\r\n        axios.put(url,data,{\r\n            headers:{'Content-type':'multipart/from-data'}\r\n        }).then(responseBody)\r\n    \r\n}\r\nconst createFormData=(product:any)=>{\r\n    let formData=new FormData();\r\n    for (const key in product) {\r\n      \r\n        formData.append(key,product[key])\r\n    }\r\n    return formData;\r\n\r\n}\r\n //to return void use {} after arrow func \r\n //to return promise delete {} after arrow func\r\nconst Admin={\r\n    createProduct:(product:any)=>requests.postForm('products',createFormData(product)),\r\n    updateProduct:(product:any)=>requests.putForm('products',createFormData(product)),\r\n\r\n    deleteProduct:(id:number)=>requests.delete(`products/${id}`)\r\n\r\n\r\n\r\n}\r\nconst Catalog = {\r\n    list: (params:URLSearchParams) => requests.get('products',params),\r\n    details: (id: string) => requests.get(`products/${id}`),\r\n    fetchFilters:()=>requests.get('products/filters')\r\n}\r\n \r\nconst Errors = {\r\n    get400Error: () => requests.get('error/bad-request'),\r\n    get401Error: () => requests.get('error/unauthorized'),\r\n    get404Error: () => requests.get('error/not-found'),\r\n    getValidationError: () => requests.get('error/validation-error'),\r\n    get500Error: () => requests.get('error/server-error')\r\n}\r\nconst Basket={\r\n    get:()=>requests.get('basket'),\r\n    addItem:(productId:number,quantity=1)=>requests.post(`basket?productId=${productId}&quantity=${quantity}`,{}),\r\n    deleteItem:(productId:number,quantity=1)=>requests.delete(`basket?productId=${productId}&quantity=${quantity}`)\r\n}\r\nconst Account={\r\n    login:(values:any)=>requests.post('account/login',values),\r\n    register:(values:any)=>requests.post('account/register',values),\r\n    currentUser:()=>requests.get('account/currentUser'),\r\n    fetchAddress:()=>requests.get('account/savedAddress')\r\n\r\n\r\n}\r\n\r\nconst Orders={\r\n    list: () => requests.get('orders'),\r\n    fetch: (id: string) => requests.get(`orders/${id}`),\r\n    create:(values:any)=>requests.post('orders',values)\r\n\r\n\r\n}\r\nconst Payment={\r\n    createPaymentIntent:()=>requests.post('payment',{})\r\n\r\n}\r\n\r\nconst agent = {\r\n    Catalog,\r\n    Errors,\r\n    Basket,\r\n    Account,\r\n    Orders,\r\n    Payment,\r\n    Admin\r\n}\r\n\r\nexport default agent;"]},"metadata":{},"sourceType":"module"}