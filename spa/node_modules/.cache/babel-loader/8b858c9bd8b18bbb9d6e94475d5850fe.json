{"ast":null,"code":"import _regeneratorRuntime from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{createAsyncThunk,createSlice,isAnyOf}from'@reduxjs/toolkit';import agent from'../../app/api/agent';import Cookies from'js-cookie';//rxslice    snippit\nvar initialState={basket:null,status:'idle'};export var fetchBasketAsync=createAsyncThunk('basket/fetchBasketAsync',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_,thunkAPI){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return agent.Basket.get();case 3:return _context.abrupt(\"return\",_context.sent);case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",thunkAPI.rejectWithValue({error:_context.t0.data}));case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}(),{condition:function condition(){if(!Cookies.get('buyerId'))return false;}});// in async we use thunkAPI for problems\nexport var addBasketItemAsync=createAsyncThunk('basket/addBasketItemAsync',/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2,thunkAPI){var productId,_ref2$quantity,quantity;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:productId=_ref2.productId,_ref2$quantity=_ref2.quantity,quantity=_ref2$quantity===void 0?1:_ref2$quantity;_context2.prev=1;// console.log('quantity is'+quantity)\nif(parseFloat(quantity.toString())===0){quantity=1;// console.log('quantity 1')\n}_context2.next=5;return agent.Basket.addItem(productId,quantity);case 5:return _context2.abrupt(\"return\",_context2.sent);case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);return _context2.abrupt(\"return\",thunkAPI.rejectWithValue({error:_context2.t0.data}));case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function(_x3,_x4){return _ref3.apply(this,arguments);};}());export var removeBasketItemAsync=createAsyncThunk('basket/removeBasketItemAsync',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4,thunkAPI){var productId,quantity;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:productId=_ref4.productId,quantity=_ref4.quantity;_context3.prev=1;_context3.next=4;return agent.Basket.deleteItem(productId,quantity);case 4:return _context3.abrupt(\"return\",_context3.sent);case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](1);return _context3.abrupt(\"return\",thunkAPI.rejectWithValue({error:_context3.t0.data}));case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[1,7]]);}));return function(_x5,_x6){return _ref5.apply(this,arguments);};}());var basketSlice=createSlice({name:'basket',initialState:initialState,reducers:{setBasket:function setBasket(state,action){state.basket=action.payload;},clearBasket:function clearBasket(state){state.basket=null;}// removeItem:(state,action)=>{\n//     const {productId,quantity}=action.payload;\n//     const itemIndex=state.basket?.items.findIndex(i=>i.productId===productId);\n//     if(itemIndex===-1 || itemIndex=== undefined) return ;\n//     state.basket!.items[itemIndex].quantity-=quantity;\n//     if(state.basket?.items[itemIndex].quantity===0)\n//     state.basket.items.splice(itemIndex,1);\n// }\n},extraReducers:function extraReducers(builder){// add\nbuilder.addCase(addBasketItemAsync.pending,function(state,action){state.status='pendingAddItem'+action.meta.arg.productId;// console.log(action)\n});///delete \nbuilder.addCase(removeBasketItemAsync.pending,function(state,action){state.status='pendingRemoveItem'+action.meta.arg.productId+action.meta.arg.name;// console.log(action)\n});builder.addCase(removeBasketItemAsync.fulfilled,function(state,action){var _state$basket,_state$basket2;state.status='idle';var _action$meta$arg=action.meta.arg,productId=_action$meta$arg.productId,quantity=_action$meta$arg.quantity;var itemIndex=(_state$basket=state.basket)===null||_state$basket===void 0?void 0:_state$basket.items.findIndex(function(i){return i.productId===productId;});if(itemIndex===-1||itemIndex===undefined)return;state.basket.items[itemIndex].quantity-=quantity;if(((_state$basket2=state.basket)===null||_state$basket2===void 0?void 0:_state$basket2.items[itemIndex].quantity)===0)state.basket.items.splice(itemIndex,1);});builder.addCase(removeBasketItemAsync.rejected,function(state,action){state.status='idle';console.log(action.payload);});builder.addMatcher(isAnyOf(addBasketItemAsync.fulfilled,fetchBasketAsync.fulfilled),function(state,action){state.status='idle';state.basket=action.payload;});builder.addMatcher(isAnyOf(addBasketItemAsync.rejected,fetchBasketAsync.rejected),function(state,action){state.status='idle';console.log(action.payload);});}});var _basketSlice$actions=basketSlice.actions,setBasket=_basketSlice$actions.setBasket,clearBasket=_basketSlice$actions.clearBasket;export{setBasket,clearBasket};export default basketSlice.reducer;","map":{"version":3,"sources":["D:/Learn/react/SouqApp/SPA/src/features/basket/basketSlice.ts"],"names":["createAsyncThunk","createSlice","isAnyOf","agent","Cookies","initialState","basket","status","fetchBasketAsync","_","thunkAPI","Basket","get","rejectWithValue","error","data","condition","addBasketItemAsync","productId","quantity","parseFloat","toString","addItem","removeBasketItemAsync","deleteItem","basketSlice","name","reducers","setBasket","state","action","payload","clearBasket","extraReducers","builder","addCase","pending","meta","arg","fulfilled","itemIndex","items","findIndex","i","undefined","splice","rejected","console","log","addMatcher","actions","reducer"],"mappings":"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","sourcesContent":["import { createAsyncThunk, createSlice, isAnyOf } from '@reduxjs/toolkit'\r\nimport { Basket } from '../../app/models/basket';\r\nimport agent from '../../app/api/agent';\r\nimport Cookies from 'js-cookie';\r\n//rxslice    snippit\r\n\r\n\r\n\r\n\r\nexport interface BasketState{\r\n\r\n    basket:Basket|null\r\n    status:string\r\n}\r\nconst initialState:BasketState = {\r\n    basket:null,\r\n    status:'idle'\r\n\r\n}\r\n\r\nexport const fetchBasketAsync=createAsyncThunk<Basket>(\r\n  'basket/fetchBasketAsync',\r\n  async(_,thunkAPI)=>{\r\n    try {\r\n      return await agent.Basket.get();\r\n     \r\n      \r\n    } \r\n    catch (error:any) {\r\n      return thunkAPI.rejectWithValue({error:error.data})\r\n     }\r\n\r\n  },{\r\n    condition:()=>{\r\n      if(!Cookies.get('buyerId')) return false;\r\n    }\r\n  }\r\n)\r\n\r\n// in async we use thunkAPI for problems\r\nexport const addBasketItemAsync=createAsyncThunk<Basket,{productId:number,quantity?:number}>(\r\n\r\n  'basket/addBasketItemAsync',\r\n  async({productId,quantity=1},thunkAPI)=>{\r\n    try {\r\n      // console.log('quantity is'+quantity)\r\n\r\n      if(parseFloat(quantity.toString()) ===0){\r\n        quantity=1;\r\n        // console.log('quantity 1')\r\n\r\n      }\r\n      \r\n      \r\n      return await agent.Basket.addItem(productId,quantity);\r\n    } catch (error:any) {\r\n      return thunkAPI.rejectWithValue({error:error.data})\r\n     }\r\n\r\n  }\r\n)\r\n\r\n\r\nexport const removeBasketItemAsync=createAsyncThunk<void,{productId:number,quantity:number,name?:string}>(\r\n\r\n  'basket/removeBasketItemAsync',\r\n  async({productId,quantity},thunkAPI)=>{\r\n    try {\r\n      return await agent.Basket.deleteItem(productId,quantity);\r\n    } catch (error:any) {\r\n      return thunkAPI.rejectWithValue({error:error.data})\r\n     }\r\n\r\n  }\r\n)\r\n\r\n\r\nconst basketSlice = createSlice({\r\n  name: 'basket',\r\n  initialState,\r\n  reducers: {\r\n    setBasket:(state,action)=>{\r\n        state.basket=action.payload\r\n    },\r\n    clearBasket:(state)=>{\r\n      state.basket=null;\r\n    }\r\n    // removeItem:(state,action)=>{\r\n    //     const {productId,quantity}=action.payload;\r\n    //     const itemIndex=state.basket?.items.findIndex(i=>i.productId===productId);\r\n    //     if(itemIndex===-1 || itemIndex=== undefined) return ;\r\n    //     state.basket!.items[itemIndex].quantity-=quantity;\r\n\r\n    //     if(state.basket?.items[itemIndex].quantity===0)\r\n    //     state.basket.items.splice(itemIndex,1);\r\n    // }\r\n\r\n  },\r\n  extraReducers: (builder=> {\r\n    \r\n    // add\r\n    builder.addCase(addBasketItemAsync.pending, (state,action)=>{\r\n      state.status='pendingAddItem'+action.meta.arg.productId;\r\n      // console.log(action)\r\n    });\r\n\r\n\r\n    ///delete \r\n\r\n    builder.addCase(removeBasketItemAsync.pending, (state,action)=>{\r\n      state.status='pendingRemoveItem'+action.meta.arg.productId+action.meta.arg.name;\r\n      // console.log(action)\r\n    });\r\n    builder.addCase(removeBasketItemAsync.fulfilled,(state,action)=>{\r\n      state.status='idle';\r\n      const {productId,quantity}=action.meta.arg;\r\n\r\n      const itemIndex=state.basket?.items.findIndex(i=>i.productId===productId);\r\n      if(itemIndex===-1 || itemIndex=== undefined) return ;\r\n      state.basket!.items[itemIndex].quantity-=quantity;\r\n\r\n      if(state.basket?.items[itemIndex].quantity===0)\r\n      state.basket.items.splice(itemIndex,1);\r\n\r\n\r\n    });\r\n    builder.addCase(removeBasketItemAsync.rejected,(state,action)=>{\r\n      state.status='idle';\r\n      console.log(action.payload);\r\n\r\n    });\r\n\r\n\r\n\r\n\r\n    builder.addMatcher(isAnyOf(addBasketItemAsync.fulfilled,fetchBasketAsync.fulfilled), (state,action)=>{\r\n      state.status='idle';\r\n      state.basket=action.payload;\r\n    });\r\n    \r\n    builder.addMatcher(isAnyOf(addBasketItemAsync.rejected,fetchBasketAsync.rejected), (state,action)=>{\r\n      state.status='idle';\r\n      console.log(action.payload);\r\n    });\r\n\r\n  })\r\n\r\n}); \r\n\r\nexport const {setBasket,clearBasket} = basketSlice.actions\r\n\r\nexport default basketSlice.reducer"]},"metadata":{},"sourceType":"module"}