{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport { history } from \"../..\";\nimport { PaginatedResponse } from \"../models/PaginationData\";\nimport { SouqStore } from \"../store/configureStore\";\n\nconst sleep = () => new Promise(resolve => setTimeout(resolve, 500)); // axios.defaults.baseURL = 'http://localhost:5000/api/';\n\n\naxios.defaults.baseURL = process.env.REACT_APP_API_URL;\naxios.defaults.withCredentials = true;\naxios.interceptors.request.use(config => {\n  var _SouqStore$getState$a;\n\n  const token = (_SouqStore$getState$a = SouqStore.getState().account.user) === null || _SouqStore$getState$a === void 0 ? void 0 : _SouqStore$getState$a.token;\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n});\naxios.interceptors.response.use(async response => {\n  if (process.env.NODE_ENV === 'development') await sleep();\n  const pagination = response.headers['pagination'];\n\n  if (pagination) {\n    response.data = new PaginatedResponse(response.data, JSON.parse(pagination));\n    return response;\n  }\n\n  return response;\n}, error => {\n  const {\n    data,\n    status\n  } = error.response;\n\n  switch (status) {\n    case 400:\n      if (data.errors) {\n        const modelStateErrors = [];\n\n        for (const key in data.errors) {\n          if (data.errors[key]) {\n            modelStateErrors.push(data.errors[key]);\n          }\n        }\n\n        throw modelStateErrors.flat();\n      }\n\n      toast.error(data.title);\n      break;\n\n    case 401:\n      toast.error(data.title);\n      break;\n\n    case 403:\n      toast.error('You are not authorized to do this !');\n      break;\n\n    case 500:\n      history.push('server-error', {\n        error: data\n      });\n      break;\n\n    default:\n      break;\n  }\n\n  return Promise.reject(error.response);\n});\n\nconst responseBody = response => response.data;\n\nconst requests = {\n  get: (url, params) => axios.get(url, {\n    params: params\n  }).then(responseBody),\n  post: (url, body) => axios.post(url, body).then(responseBody),\n  put: (url, body) => axios.put(url, body).then(responseBody),\n  delete: url => axios.delete(url).then(responseBody),\n  postForm: (url, data) => axios.post(url, data, {\n    headers: {\n      'Content-type': 'multipart/from-data'\n    }\n  }).then(responseBody),\n  putForm: (url, data) => axios.put(url, data, {\n    headers: {\n      'Content-type': 'multipart/from-data'\n    }\n  }).then(responseBody)\n};\n\nconst createFormData = product => {\n  let formData = new FormData();\n\n  for (const key in product) {\n    formData.append(key, product[key]);\n  }\n\n  return formData;\n}; //to return void use {} after arrow func \n//to return promise delete {} after arrow func\n\n\nconst Admin = {\n  createProduct: product => requests.postForm('products', createFormData(product)),\n  updateProduct: product => requests.putForm('products', createFormData(product)),\n  deleteProduct: id => requests.delete(`products/${id}`)\n};\nconst Catalog = {\n  list: params => requests.get('products', params),\n  details: id => requests.get(`products/${id}`),\n  fetchFilters: () => requests.get('products/filters')\n};\nconst Errors = {\n  get400Error: () => requests.get('error/bad-request'),\n  get401Error: () => requests.get('error/unauthorized'),\n  get404Error: () => requests.get('error/not-found'),\n  getValidationError: () => requests.get('error/validation-error'),\n  get500Error: () => requests.get('error/server-error')\n};\nconst Basket = {\n  get: () => requests.get('basket'),\n  addItem: function (productId) {\n    let quantity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return requests.post(`basket?productId=${productId}&quantity=${quantity}`, {});\n  },\n  deleteItem: function (productId) {\n    let quantity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return requests.delete(`basket?productId=${productId}&quantity=${quantity}`);\n  }\n};\nconst Account = {\n  login: values => requests.post('account/login', values),\n  register: values => requests.post('account/register', values),\n  currentUser: () => requests.get('account/currentUser'),\n  fetchAddress: () => requests.get('account/savedAddress')\n};\nconst Orders = {\n  list: () => requests.get('orders'),\n  fetch: id => requests.get(`orders/${id}`),\n  create: values => requests.post('orders', values)\n};\nconst Payment = {\n  createPaymentIntent: () => requests.post('payment', {})\n};\nconst agent = {\n  Catalog,\n  Errors,\n  Basket,\n  Account,\n  Orders,\n  Payment,\n  Admin\n};\nexport default agent;","map":{"version":3,"sources":["D:/Learn/react/SouqApp/spa/src/app/api/agent.ts"],"names":["axios","toast","history","PaginatedResponse","SouqStore","sleep","Promise","resolve","setTimeout","defaults","baseURL","process","env","REACT_APP_API_URL","withCredentials","interceptors","request","use","config","token","getState","account","user","headers","Authorization","response","NODE_ENV","pagination","data","JSON","parse","error","status","errors","modelStateErrors","key","push","flat","title","reject","responseBody","requests","get","url","params","then","post","body","put","delete","postForm","putForm","createFormData","product","formData","FormData","append","Admin","createProduct","updateProduct","deleteProduct","id","Catalog","list","details","fetchFilters","Errors","get400Error","get401Error","get404Error","getValidationError","get500Error","Basket","addItem","productId","quantity","deleteItem","Account","login","values","register","currentUser","fetchAddress","Orders","fetch","create","Payment","createPaymentIntent","agent"],"mappings":"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","sourcesContent":["import axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport { toast } from \"react-toastify\";\r\nimport { history } from \"../..\";\r\nimport { PaginatedResponse } from \"../models/PaginationData\";\r\nimport { SouqStore } from \"../store/configureStore\";\r\n\r\nconst sleep = () => new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n// axios.defaults.baseURL = 'http://localhost:5000/api/';\r\naxios.defaults.baseURL = process.env.REACT_APP_API_URL;\r\n\r\n\r\naxios.defaults.withCredentials=true;\r\n\r\naxios.interceptors.request.use(config=>{\r\n    const token=SouqStore.getState().account.user?.token;\r\n    if(token)config.headers!.Authorization=`Bearer ${token}`;\r\n    return config;\r\n})\r\n\r\naxios.interceptors.response.use(async response => {\r\n\r\n    if(process.env.NODE_ENV==='development')await sleep();\r\n\r\n    const pagination=response.headers['pagination'];\r\n    if(pagination){\r\n        response.data=new PaginatedResponse(response.data,JSON.parse(pagination));\r\n        return response;\r\n    }\r\n    return response\r\n}, (error: AxiosError) => {\r\n    const { data, status } = error.response!;\r\n\r\n    switch (status) {\r\n        case 400:\r\n            if (data.errors) {\r\n                const modelStateErrors: string[] = [];\r\n                for (const key in data.errors) {\r\n                    if (data.errors[key]) {\r\n                        modelStateErrors.push(data.errors[key])\r\n                    }\r\n                }\r\n                throw modelStateErrors.flat()\r\n            }\r\n            toast.error(data.title)\r\n            break;\r\n        case 401:\r\n            toast.error(data.title)\r\n           \r\n            break;\r\n            case 403:\r\n                toast.error('You are not authorized to do this !')\r\n               \r\n                break;\r\n        case 500:\r\n            history.push('server-error', { error: data })\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return Promise.reject(error.response);\r\n})\r\nconst responseBody = (response: AxiosResponse) => response.data;\r\nconst requests = {\r\n    get: (url: string,params?:URLSearchParams) => axios.get(url,{params:params}).then(responseBody),\r\n    post: (url: string, body: {}) => axios.post(url, body).then(responseBody),\r\n    put: (url: string, body: {}) => axios.put(url, body).then(responseBody),\r\n    delete: (url: string) => axios.delete(url).then(responseBody),\r\n    postForm:(url:string,data:FormData)=>\r\n        axios.post(url,data,{\r\n            headers:{'Content-type':'multipart/from-data'}\r\n        }).then(responseBody)\r\n    ,\r\n    putForm:(url:string,data:FormData)=>\r\n        axios.put(url,data,{\r\n            headers:{'Content-type':'multipart/from-data'}\r\n        }).then(responseBody)\r\n    \r\n}\r\nconst createFormData=(product:any)=>{\r\n    let formData=new FormData();\r\n    for (const key in product) {\r\n      \r\n        formData.append(key,product[key])\r\n    }\r\n    return formData;\r\n\r\n}\r\n //to return void use {} after arrow func \r\n //to return promise delete {} after arrow func\r\nconst Admin={\r\n    createProduct:(product:any)=>requests.postForm('products',createFormData(product)),\r\n    updateProduct:(product:any)=>requests.putForm('products',createFormData(product)),\r\n\r\n    deleteProduct:(id:number)=>requests.delete(`products/${id}`)\r\n\r\n\r\n\r\n}\r\nconst Catalog = {\r\n    list: (params:URLSearchParams) => requests.get('products',params),\r\n    details: (id: string) => requests.get(`products/${id}`),\r\n    fetchFilters:()=>requests.get('products/filters')\r\n}\r\n \r\nconst Errors = {\r\n    get400Error: () => requests.get('error/bad-request'),\r\n    get401Error: () => requests.get('error/unauthorized'),\r\n    get404Error: () => requests.get('error/not-found'),\r\n    getValidationError: () => requests.get('error/validation-error'),\r\n    get500Error: () => requests.get('error/server-error')\r\n}\r\nconst Basket={\r\n    get:()=>requests.get('basket'),\r\n    addItem:(productId:number,quantity=1)=>requests.post(`basket?productId=${productId}&quantity=${quantity}`,{}),\r\n    deleteItem:(productId:number,quantity=1)=>requests.delete(`basket?productId=${productId}&quantity=${quantity}`)\r\n}\r\nconst Account={\r\n    login:(values:any)=>requests.post('account/login',values),\r\n    register:(values:any)=>requests.post('account/register',values),\r\n    currentUser:()=>requests.get('account/currentUser'),\r\n    fetchAddress:()=>requests.get('account/savedAddress')\r\n\r\n\r\n}\r\n\r\nconst Orders={\r\n    list: () => requests.get('orders'),\r\n    fetch: (id: string) => requests.get(`orders/${id}`),\r\n    create:(values:any)=>requests.post('orders',values)\r\n\r\n\r\n}\r\nconst Payment={\r\n    createPaymentIntent:()=>requests.post('payment',{})\r\n\r\n}\r\n\r\nconst agent = {\r\n    Catalog,\r\n    Errors,\r\n    Basket,\r\n    Account,\r\n    Orders,\r\n    Payment,\r\n    Admin\r\n}\r\n\r\nexport default agent;"]},"metadata":{},"sourceType":"module"}