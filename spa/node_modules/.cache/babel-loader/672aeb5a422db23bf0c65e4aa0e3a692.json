{"ast":null,"code":"import _regeneratorRuntime from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Learn/react/SouqApp/spa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{Box,Paper,Typography,Grid,Button}from\"@mui/material\";import{useForm}from\"react-hook-form\";import AppTextInput from\"../../app/components/AppTextInput\";import{useEffect}from\"react\";import AppSelectList from\"../../app/components/AppSelectList\";import useProducts from\"../../app/hooks/useProducts\";import AppDropZone from\"../../app/components/AppDropZone\";import{yupResolver}from\"@hookform/resolvers/yup\";import{productValidationSchema}from\"./productValidation\";import agent from\"../../app/api/agent\";import{useAppDispatch}from\"../../app/store/configureStore\";import{setProduct}from\"../catalog/catalogSlice\";import{LoadingButton}from\"@mui/lab\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProductForm(_ref){var product=_ref.product,cancelEdit=_ref.cancelEdit;var _useForm=useForm({resolver:yupResolver(productValidationSchema)}),control=_useForm.control,reset=_useForm.reset,handleSubmit=_useForm.handleSubmit,watch=_useForm.watch,_useForm$formState=_useForm.formState,isDirty=_useForm$formState.isDirty,isSubmitting=_useForm$formState.isSubmitting;var _useProducts=useProducts(),brands=_useProducts.brands,types=_useProducts.types;var watchFile=watch('file',null);var disptach=useAppDispatch();useEffect(function(){if(product&&!watchFile&&!isDirty)reset(product);return function(){if(watchFile)URL.revokeObjectURL(watchFile.preview);};},[product,reset,watchFile,isDirty]);var handleSubmitData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!product){_context.next=9;break;}_context.next=4;return agent.Admin.updateProduct(data);case 4:response=_context.sent;disptach(setProduct(response));cancelEdit();_context.next=14;break;case 9:_context.next=11;return agent.Admin.createProduct(data);case 11:response=_context.sent;disptach(setProduct(response));cancelEdit();case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,16]]);}));return function handleSubmitData(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Box,{component:Paper,sx:{px:4,py:2,mt:10,mx:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,sx:{mb:4},children:\"Product Details\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(handleSubmitData),children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:12,children:/*#__PURE__*/_jsx(AppTextInput,{control:control,name:\"name\",label:\"Product name\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(AppSelectList,{control:control,items:brands,name:\"brand\",label:\"Brand\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(AppSelectList,{control:control,items:types,name:\"type\",label:\"Type\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(AppTextInput,{control:control,type:\"number\",name:\"price\",label:\"Price\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(AppTextInput,{control:control,type:\"number\",name:\"quantityInStock\",label:\"Quantity in Stock\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(AppTextInput,{control:control,multiline:true,rows:3,name:\"description\",label:\"Description\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",children:[/*#__PURE__*/_jsx(AppDropZone,{control:control,name:\"file\"}),watchFile?/*#__PURE__*/_jsx(\"img\",{src:watchFile.preview,alt:\"preview\",style:{marginLeft:80,maxHeight:150}}):/*#__PURE__*/_jsx(\"img\",{src:product===null||product===void 0?void 0:product.pictureUrl,alt:product===null||product===void 0?void 0:product.name,style:{marginLeft:80,maxHeight:150}})]})})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",sx:{mt:3},children:[/*#__PURE__*/_jsx(Button,{onClick:cancelEdit,variant:\"contained\",color:\"inherit\",children:\"Cancel\"}),/*#__PURE__*/_jsx(LoadingButton,{loading:isSubmitting,type:\"submit\",variant:\"contained\",color:\"primary\",children:\"Submit\"})]})]})]});}","map":{"version":3,"sources":["D:/Learn/react/SouqApp/SPA/src/features/admin/ProductForm.tsx"],"names":["Box","Paper","Typography","Grid","Button","useForm","AppTextInput","useEffect","AppSelectList","useProducts","AppDropZone","yupResolver","productValidationSchema","agent","useAppDispatch","setProduct","LoadingButton","ProductForm","product","cancelEdit","resolver","control","reset","handleSubmit","watch","formState","isDirty","isSubmitting","brands","types","watchFile","disptach","URL","revokeObjectURL","preview","handleSubmitData","data","Admin","updateProduct","response","createProduct","console","log","px","py","mt","mx","mb","marginLeft","maxHeight","pictureUrl","name"],"mappings":"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","sourcesContent":["import { Box, Paper, Typography, Grid, Button } from \"@mui/material\";\r\nimport { FieldValues, useForm } from \"react-hook-form\";\r\nimport AppTextInput from \"../../app/components/AppTextInput\";\r\nimport { Product } from \"../../app/models/product\";\r\nimport { useEffect } from \"react\";\r\nimport AppSelectList from \"../../app/components/AppSelectList\";\r\nimport useProducts from \"../../app/hooks/useProducts\";\r\nimport AppDropZone from \"../../app/components/AppDropZone\";\r\nimport { yupResolver } from \"@hookform/resolvers/yup\";\r\nimport { productValidationSchema } from \"./productValidation\";\r\nimport agent from \"../../app/api/agent\";\r\nimport { useAppDispatch } from \"../../app/store/configureStore\";\r\nimport { setProduct } from \"../catalog/catalogSlice\";\r\nimport { LoadingButton } from \"@mui/lab\";\r\n\r\n\r\ntype Props={\r\n    product?:Product,\r\n    cancelEdit:()=>void\r\n}\r\n\r\nexport default function ProductForm({product,cancelEdit}:Props) {\r\n    const { control ,reset,handleSubmit,watch,formState:{isDirty,isSubmitting}} = useForm({\r\n        resolver:yupResolver<any>(productValidationSchema)\r\n    });\r\n    const {brands,types}=useProducts();\r\n\r\n    const watchFile=watch('file',null);\r\n    const disptach=useAppDispatch();\r\n\r\n    useEffect(()=>{\r\n        if(product && !watchFile && !isDirty)reset(product)\r\n        return()=>{\r\n            if(watchFile)URL.revokeObjectURL(watchFile.preview);\r\n        }\r\n    },[product,reset,watchFile,isDirty])\r\n\r\n    const handleSubmitData=async (data:FieldValues)=>{\r\n        try {\r\n            let response:Product;\r\n            if(product){\r\n                response=await agent.Admin.updateProduct(data);\r\n                disptach(setProduct(response));\r\n                cancelEdit();\r\n            }else{\r\n                response=await agent.Admin.createProduct(data);\r\n\r\n                disptach(setProduct(response));\r\n                cancelEdit();\r\n            }\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n\r\n        }\r\n    }\r\n    return (\r\n        <Box component={Paper} sx={{ px: 4, py: 2, mt: 10, mx: 2 }}>\r\n            <Typography variant=\"h4\" gutterBottom sx={{ mb: 4 }}>\r\n                Product Details\r\n            </Typography>\r\n            <form onSubmit={handleSubmit(handleSubmitData)}>\r\n\r\n           \r\n            <Grid container spacing={2}>\r\n                <Grid item xs={12} sm={12}>\r\n                    <AppTextInput control={control} name='name' label='Product name' />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6}>\r\n                    <AppSelectList control={control} items={brands}  name='brand' label='Brand' />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6}>\r\n                    <AppSelectList control={control} items={types}  name='type' label='Type' />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6}>\r\n                    <AppTextInput control={control} type=\"number\" name='price' label='Price' />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6}>\r\n                    <AppTextInput control={control} type=\"number\" name='quantityInStock' label='Quantity in Stock' />\r\n                </Grid>\r\n                <Grid item xs={12}>\r\n                    <AppTextInput control={control} multiline rows={3} name='description' label='Description' />\r\n                </Grid>\r\n                <Grid item xs={12}>\r\n                    <Box display='flex'>\r\n                    <AppDropZone control={control} name='file' />\r\n                    {\r\n                        watchFile?(\r\n                            <img src={watchFile.preview} alt='preview' style={{marginLeft:80,maxHeight:150}}/>\r\n                        ):(\r\n                            <img src={product?.pictureUrl} alt={product?.name} style={{marginLeft:80,maxHeight:150}}/>\r\n                        )\r\n                    }\r\n\r\n                    </Box>\r\n                </Grid>\r\n            </Grid>\r\n            <Box display='flex' justifyContent='space-between' sx={{ mt: 3 }}>\r\n                <Button onClick={cancelEdit} variant='contained' color='inherit'>Cancel</Button>\r\n                <LoadingButton loading={isSubmitting} type=\"submit\" variant='contained' color='primary'>Submit</LoadingButton>\r\n            </Box>\r\n            </form>\r\n        </Box>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}