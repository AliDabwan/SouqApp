{"ast":null,"code":"import axios from \"axios\";\nimport { toast } from \"react-toastify\";\nimport { history } from \"../..\";\n\nconst sleep = () => new Promise(resolve => setTimeout(resolve, 500));\n\naxios.defaults.baseURL = 'http://localhost:5000/api/';\naxios.defaults.withCredentials = true;\naxios.interceptors.response.use(async response => {\n  await sleep();\n  return response;\n}, error => {\n  const {\n    data,\n    status\n  } = error.response;\n\n  switch (status) {\n    case 400:\n      if (data.errors) {\n        const modelStateErrors = [];\n\n        for (const key in data.errors) {\n          if (data.errors[key]) {\n            modelStateErrors.push(data.errors[key]);\n          }\n        }\n\n        throw modelStateErrors.flat();\n      }\n\n      toast.error(data.title);\n      break;\n\n    case 401:\n      toast.error(data.title);\n      break;\n\n    case 500:\n      history.push('server-error', {\n        error: data\n      });\n      break;\n\n    default:\n      break;\n  }\n\n  return Promise.reject(error.response);\n});\n\nconst responseBody = response => response.data;\n\nconst requests = {\n  get: url => axios.get(url).then(responseBody),\n  post: (url, body) => axios.post(url, body).then(responseBody),\n  put: (url, body) => axios.put(url, body).then(responseBody),\n  delete: url => axios.delete(url).then(responseBody)\n};\nconst Catalog = {\n  list: () => requests.get('products'),\n  details: id => requests.get(`products/${id}`)\n};\nconst Errors = {\n  get400Error: () => requests.get('error/bad-request'),\n  get401Error: () => requests.get('error/unauthorized'),\n  get404Error: () => requests.get('error/not-found'),\n  getValidationError: () => requests.get('error/validation-error'),\n  get500Error: () => requests.get('error/server-error')\n};\nconst Basket = {\n  get: () => requests.get('basket'),\n  addItem: function (productId) {\n    let quantity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return requests.post(`basket?productId=100&quantity=${quantity}`, {});\n  },\n  deleteItem: function (productId) {\n    let quantity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return requests.delete(`basket?productId=150&quantity=${quantity}`);\n  }\n};\nconst agent = {\n  Catalog,\n  Errors,\n  Basket\n};\nexport default agent;","map":{"version":3,"sources":["D:/Learn/react/SouqApp/spa/src/app/api/agent.ts"],"names":["axios","toast","history","sleep","Promise","resolve","setTimeout","defaults","baseURL","withCredentials","interceptors","response","use","error","data","status","errors","modelStateErrors","key","push","flat","title","reject","responseBody","requests","get","url","then","post","body","put","delete","Catalog","list","details","id","Errors","get400Error","get401Error","get404Error","getValidationError","get500Error","Basket","addItem","productId","quantity","deleteItem","agent"],"mappings":"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","sourcesContent":["import axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport { toast } from \"react-toastify\";\r\nimport { history } from \"../..\";\r\n\r\nconst sleep = () => new Promise(resolve => setTimeout(resolve, 500));\r\naxios.defaults.baseURL = 'http://localhost:5000/api/';\r\naxios.defaults.withCredentials=true;\r\naxios.interceptors.response.use(async response => {\r\n    await sleep();\r\n    return response\r\n}, (error: AxiosError) => {\r\n    const { data, status } = error.response!;\r\n    switch (status) {\r\n        case 400:\r\n            if (data.errors) {\r\n                const modelStateErrors: string[] = [];\r\n                for (const key in data.errors) {\r\n                    if (data.errors[key]) {\r\n                        modelStateErrors.push(data.errors[key])\r\n                    }\r\n                }\r\n                throw modelStateErrors.flat()\r\n            }\r\n            toast.error(data.title)\r\n            break;\r\n        case 401:\r\n            toast.error(data.title)\r\n            break;\r\n        case 500:\r\n            history.push('server-error', { error: data })\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return Promise.reject(error.response);\r\n})\r\nconst responseBody = (response: AxiosResponse) => response.data;\r\nconst requests = {\r\n    get: (url: string) => axios.get(url).then(responseBody),\r\n    post: (url: string, body: {}) => axios.post(url, body).then(responseBody),\r\n    put: (url: string, body: {}) => axios.put(url, body).then(responseBody),\r\n    delete: (url: string) => axios.delete(url).then(responseBody)\r\n}\r\nconst Catalog = {\r\n    list: () => requests.get('products'),\r\n    details: (id: string) => requests.get(`products/${id}`)\r\n}\r\n\r\nconst Errors = {\r\n    get400Error: () => requests.get('error/bad-request'),\r\n    get401Error: () => requests.get('error/unauthorized'),\r\n    get404Error: () => requests.get('error/not-found'),\r\n    getValidationError: () => requests.get('error/validation-error'),\r\n    get500Error: () => requests.get('error/server-error')\r\n}\r\nconst Basket={\r\n    get:()=>requests.get('basket'),\r\n    addItem:(productId:number,quantity=1)=>requests.post(`basket?productId=100&quantity=${quantity}`,{}),\r\n    deleteItem:(productId:number,quantity=1)=>requests.delete(`basket?productId=150&quantity=${quantity}`)\r\n}\r\n\r\nconst agent = {\r\n    Catalog,\r\n    Errors,\r\n    Basket\r\n}\r\n\r\nexport default agent;"]},"metadata":{},"sourceType":"module"}